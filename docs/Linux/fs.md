## 文件系统

磁盘分区 -> 物理划分    

物理block 

 磁盘读写IO 一次一个扇区512字节, 性能差， 由此生成了逻辑块，由磁盘驱动器进行维护，一个逻辑块（LBA) 包含一个或者多个扇区，一次读写一个逻辑块，并由磁盘驱动器映射到指定的扇区读写。

文件系统block

文件系统数据块的大小一般为1K,2K或4K, 由文件系统维护，文件系统IO管理器知道如何将数据块翻译成磁盘维护的数据块地址（LBA)

inode 解决文件block索引问题

bmap 解决文件系统块空闲的问题 （写优化，只有写需要知道空闲block）

inode表 解决inode 空间浪费的问题

imap 解决文件系统空间inode查找问题

块组 解决 bmap 、inode table、imap 太大的问题

​	GDT (group descriptor table) 块组的信息和属性元数据

​	Reserved GDT  扩容文件系统用，防止块组太多，超出当前存储的GDT blocks

data block

- 常规文件 存储在数据块

- 目录和目录下所有文件和一级子目录的目录名存储在数据块中

    - 文件名和inode号存储在所属目录的data block中

        ![img](https://www.junmajinlong.com/img/linux/733013-20191005161844399-1089052435.jpg)

        ![文件类型](https://www.junmajinlong.com/img/linux/733013-20170615094424884-1119563692.jpg)

- 符号连接，短名称直接保存在inode中，长名称分配数据块来保存

    - 链接文件的一切都依赖于其目标文件名
    - 不能跨分区创建硬链接,不同文件系统的inode号可能相同，造成inode冲突
    - 硬链接只能对文件，不能对目录
    - 软连接根据创建时的指向路径，移动软连接时该指向不会改变

- 设备文件、FIFO和socket等特殊文件没有数据块，设备文件的主设备号和次设备号保存在inode中

通过inode号可以计算并索引到inode table 中该inode号的inode记录

文件系统自引用，自引用的只能是文件系统，文件系统的表现形式是目录，所以自引用指该目录中 "." 和 ".." 的inode号相同，互为硬链接

文件系统挂载的细节

虚拟文件系统 vfs，提供不同的文件系统调用。

### ZFS

配置文件 /etc/default/zfs, 包含自动挂载等等



